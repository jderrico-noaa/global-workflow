<?xml version="1.0"?>
<!DOCTYPE workflow
[
	<!--
	PROGRAM
		Main workflow manager for Global Forecast System

	NOTES:
		This workflow was automatically generated at 2023-06-01 19:51:13.164814
	-->
	<!ENTITY PSLOT "test">
	<!ENTITY ROTDIR "/lfs1/BMC/gsd-fv3-test/jhender/scratch/emc_gw/FV3GFSrun/test">
	<!ENTITY JOBS_DIR "/mnt/lfs1/BMC/gsd-fv3-test/jhender/scratch/emc_gw/jobs/rocoto">
	<!ENTITY MAXTRIES "2">
]>

<workflow realtime="F" scheduler="slurm" cyclethrottle="3" taskthrottle="25">

	<log verbosity="10"><cyclestr>/lfs1/BMC/gsd-fv3-test/jhender/scratch/emc_gw/FV3GFSwfm/test/logs/@Y@m@d@H.log</cyclestr></log>

	<!-- Define the cycles -->
	<cycledef group="gfs">202211090000 202211090000 24:00:00</cycledef>

<task name="gfscoupled_ic" cycledefs="gfs" maxtries="&MAXTRIES;">

	<command>&JOBS_DIR;/coupled_ic.sh</command>

	<jobname><cyclestr>&PSLOT;_gfscoupled_ic_@H</cyclestr></jobname>
	<account>hfv3gfs</account>
	<queue>batch</queue>
	<partition>xjet</partition>
	<walltime>00:15:00</walltime>
	<nodes>1:ppn=1:tpp=1</nodes>
	<native>--export=NONE</native>

	<join><cyclestr>&ROTDIR;/logs/@Y@m@d@H/gfscoupled_ic.log</cyclestr></join>

	<envar><name>RUN_ENVIR</name><value>emc</value></envar>
	<envar><name>HOMEgfs</name><value>/mnt/lfs1/BMC/gsd-fv3-test/jhender/scratch/emc_gw</value></envar>
	<envar><name>EXPDIR</name><value>/lfs1/BMC/gsd-fv3-test/jhender/scratch/emc_gw/FV3GFSwfm/test</value></envar>
	<envar><name>NET</name><value>gfs</value></envar>
	<envar><name>CDUMP</name><value>gfs</value></envar>
	<envar><name>RUN</name><value>gfs</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>COMROOT</name><value>/lfs4/HFIP/hfv3gfs/glopara/com</value></envar>
	<envar><name>DATAROOT</name><value> /lfs1/BMC/gsd-fv3-test/Judy.K.Henderson/scratch/stmp/RUNDIRS/test</value></envar>

	<dependency>
		<and>
			<datadep><cyclestr>/mnt/lfs4/HFIP/hfv3gfs/glopara/data/ICSDIR/prototype_ICs/HR1/@Y@m@d@H/gfs/C768/INPUT/gfs_ctrl.nc</cyclestr></datadep>
			<datadep><cyclestr>/mnt/lfs4/HFIP/hfv3gfs/glopara/data/ICSDIR/prototype_ICs/HR1/@Y@m@d@H/gfs/C768/INPUT/gfs_data.tile1.nc</cyclestr></datadep>
			<datadep><cyclestr>/mnt/lfs4/HFIP/hfv3gfs/glopara/data/ICSDIR/prototype_ICs/HR1/@Y@m@d@H/gfs/C768/INPUT/gfs_data.tile2.nc</cyclestr></datadep>
			<datadep><cyclestr>/mnt/lfs4/HFIP/hfv3gfs/glopara/data/ICSDIR/prototype_ICs/HR1/@Y@m@d@H/gfs/C768/INPUT/gfs_data.tile3.nc</cyclestr></datadep>
			<datadep><cyclestr>/mnt/lfs4/HFIP/hfv3gfs/glopara/data/ICSDIR/prototype_ICs/HR1/@Y@m@d@H/gfs/C768/INPUT/gfs_data.tile4.nc</cyclestr></datadep>
			<datadep><cyclestr>/mnt/lfs4/HFIP/hfv3gfs/glopara/data/ICSDIR/prototype_ICs/HR1/@Y@m@d@H/gfs/C768/INPUT/gfs_data.tile5.nc</cyclestr></datadep>
			<datadep><cyclestr>/mnt/lfs4/HFIP/hfv3gfs/glopara/data/ICSDIR/prototype_ICs/HR1/@Y@m@d@H/gfs/C768/INPUT/gfs_data.tile6.nc</cyclestr></datadep>
			<datadep><cyclestr>/mnt/lfs4/HFIP/hfv3gfs/glopara/data/ICSDIR/prototype_ICs/HR1/@Y@m@d@H/gfs/C768/INPUT/sfc_data.tile1.nc</cyclestr></datadep>
			<datadep><cyclestr>/mnt/lfs4/HFIP/hfv3gfs/glopara/data/ICSDIR/prototype_ICs/HR1/@Y@m@d@H/gfs/C768/INPUT/sfc_data.tile2.nc</cyclestr></datadep>
			<datadep><cyclestr>/mnt/lfs4/HFIP/hfv3gfs/glopara/data/ICSDIR/prototype_ICs/HR1/@Y@m@d@H/gfs/C768/INPUT/sfc_data.tile3.nc</cyclestr></datadep>
			<datadep><cyclestr>/mnt/lfs4/HFIP/hfv3gfs/glopara/data/ICSDIR/prototype_ICs/HR1/@Y@m@d@H/gfs/C768/INPUT/sfc_data.tile4.nc</cyclestr></datadep>
			<datadep><cyclestr>/mnt/lfs4/HFIP/hfv3gfs/glopara/data/ICSDIR/prototype_ICs/HR1/@Y@m@d@H/gfs/C768/INPUT/sfc_data.tile5.nc</cyclestr></datadep>
			<datadep><cyclestr>/mnt/lfs4/HFIP/hfv3gfs/glopara/data/ICSDIR/prototype_ICs/HR1/@Y@m@d@H/gfs/C768/INPUT/sfc_data.tile6.nc</cyclestr></datadep>
		</and>
	</dependency>

</task>

<task name="gfsfcst" cycledefs="gfs" maxtries="&MAXTRIES;">

	<command>&JOBS_DIR;/fcst.sh</command>

	<jobname><cyclestr>&PSLOT;_gfsfcst_@H</cyclestr></jobname>
	<account>hfv3gfs</account>
	<queue>batch</queue>
	<partition>xjet</partition>
	<walltime>06:00:00</walltime>
	<nodes>192:ppn=24:tpp=1</nodes>
	<native>--export=NONE</native>

	<join><cyclestr>&ROTDIR;/logs/@Y@m@d@H/gfsfcst.log</cyclestr></join>

	<envar><name>RUN_ENVIR</name><value>emc</value></envar>
	<envar><name>HOMEgfs</name><value>/mnt/lfs1/BMC/gsd-fv3-test/jhender/scratch/emc_gw</value></envar>
	<envar><name>EXPDIR</name><value>/lfs1/BMC/gsd-fv3-test/jhender/scratch/emc_gw/FV3GFSwfm/test</value></envar>
	<envar><name>NET</name><value>gfs</value></envar>
	<envar><name>CDUMP</name><value>gfs</value></envar>
	<envar><name>RUN</name><value>gfs</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>COMROOT</name><value>/lfs4/HFIP/hfv3gfs/glopara/com</value></envar>
	<envar><name>DATAROOT</name><value> /lfs1/BMC/gsd-fv3-test/Judy.K.Henderson/scratch/stmp/RUNDIRS/test</value></envar>

	<dependency>
		<and>
			<taskdep task="gfscoupled_ic"/>
		</and>
	</dependency>

</task>

<metatask name="gfspost">

	<var name="grp">_f000-f003 _f006-f009 _f012-f015 _f018-f021 _f024-f027 _f030-f033 _f036-f039 _f042-f045 _f048-f051 _f054-f057 _f060-f063 _f066-f069 _f072-f075 _f078-f081 _f084-f087 _f090-f090 _f093-f093 _f096-f096 _f099-f099 _f102-f102 _f105-f105 _f108-f108 _f111-f111 _f114-f114 _f117-f117 _f120-f120 _f123-f123 _f126-f126 _f129-f129 _f132-f132 _f135-f135 _f138-f138 _f141-f141 _f144-f144 _f147-f147 _f150-f150 _f153-f153 _f156-f156 _f159-f159 _f162-f162 _f165-f165 _f168-f168</var>
	<var name="dep">f003 f009 f015 f021 f027 f033 f039 f045 f051 f057 f063 f069 f075 f081 f087 f090 f093 f096 f099 f102 f105 f108 f111 f114 f117 f120 f123 f126 f129 f132 f135 f138 f141 f144 f147 f150 f153 f156 f159 f162 f165 f168</var>
	<var name="lst">f000_f003 f006_f009 f012_f015 f018_f021 f024_f027 f030_f033 f036_f039 f042_f045 f048_f051 f054_f057 f060_f063 f066_f069 f072_f075 f078_f081 f084_f087 f090 f093 f096 f099 f102 f105 f108 f111 f114 f117 f120 f123 f126 f129 f132 f135 f138 f141 f144 f147 f150 f153 f156 f159 f162 f165 f168</var>

	<task name="gfspost#grp#" cycledefs="gfs" maxtries="&MAXTRIES;">

		<command>&JOBS_DIR;/post.sh</command>

		<jobname><cyclestr>&PSLOT;_gfspost#grp#_@H</cyclestr></jobname>
		<account>hfv3gfs</account>
		<queue>batch</queue>
		<partition>xjet</partition>
		<walltime>01:00:00</walltime>
		<nodes>6:ppn=24:tpp=1</nodes>
		<native>--export=NONE</native>

		<join><cyclestr>&ROTDIR;/logs/@Y@m@d@H/gfspost#grp#.log</cyclestr></join>

		<envar><name>RUN_ENVIR</name><value>emc</value></envar>
		<envar><name>HOMEgfs</name><value>/mnt/lfs1/BMC/gsd-fv3-test/jhender/scratch/emc_gw</value></envar>
		<envar><name>EXPDIR</name><value>/lfs1/BMC/gsd-fv3-test/jhender/scratch/emc_gw/FV3GFSwfm/test</value></envar>
		<envar><name>NET</name><value>gfs</value></envar>
		<envar><name>CDUMP</name><value>gfs</value></envar>
		<envar><name>RUN</name><value>gfs</value></envar>
		<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
		<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
		<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
		<envar><name>COMROOT</name><value>/lfs4/HFIP/hfv3gfs/glopara/com</value></envar>
		<envar><name>DATAROOT</name><value> /lfs1/BMC/gsd-fv3-test/Judy.K.Henderson/scratch/stmp/RUNDIRS/test</value></envar>
		<envar><name>FHRGRP</name><value>#grp#</value></envar>
		<envar><name>FHRLST</name><value>#lst#</value></envar>
		<envar><name>ROTDIR</name><value>/lfs1/BMC/gsd-fv3-test/jhender/scratch/emc_gw/FV3GFSrun/test</value></envar>

		<dependency>
			<or>
				<datadep><cyclestr>&ROTDIR;/gfs.@Y@m@d/@H//model_data/atmos/history/gfs.t@Hz.atm.log#dep#.txt</cyclestr></datadep>
				<taskdep task="gfsfcst"/>
			</or>
		</dependency>

	</task>

</metatask>

<task name="gfsvrfy" cycledefs="gfs" maxtries="&MAXTRIES;">

	<command>&JOBS_DIR;/vrfy.sh</command>

	<jobname><cyclestr>&PSLOT;_gfsvrfy_@H</cyclestr></jobname>
	<account>hfv3gfs</account>
	<queue>batch</queue>
	<partition>xjet</partition>
	<walltime>06:00:00</walltime>
	<nodes>1:ppn=1:tpp=1</nodes>
	<native>--export=NONE</native>

	<join><cyclestr>&ROTDIR;/logs/@Y@m@d@H/gfsvrfy.log</cyclestr></join>

	<envar><name>RUN_ENVIR</name><value>emc</value></envar>
	<envar><name>HOMEgfs</name><value>/mnt/lfs1/BMC/gsd-fv3-test/jhender/scratch/emc_gw</value></envar>
	<envar><name>EXPDIR</name><value>/lfs1/BMC/gsd-fv3-test/jhender/scratch/emc_gw/FV3GFSwfm/test</value></envar>
	<envar><name>NET</name><value>gfs</value></envar>
	<envar><name>CDUMP</name><value>gfs</value></envar>
	<envar><name>RUN</name><value>gfs</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>COMROOT</name><value>/lfs4/HFIP/hfv3gfs/glopara/com</value></envar>
	<envar><name>DATAROOT</name><value> /lfs1/BMC/gsd-fv3-test/Judy.K.Henderson/scratch/stmp/RUNDIRS/test</value></envar>

	<dependency>
		<metataskdep metatask="gfspost"/>
	</dependency>

</task>

<metatask name="gfsmetp">

	<var name="metpcase">g2g1 g2o1 pcp1</var>

	<task name="gfsmetp#metpcase#" cycledefs="gfs" maxtries="&MAXTRIES;">

		<command>&JOBS_DIR;/metp.sh</command>

		<jobname><cyclestr>&PSLOT;_gfsmetp#metpcase#_@H</cyclestr></jobname>
		<account>hfv3gfs</account>
		<queue>batch</queue>
		<partition>xjet</partition>
		<walltime>06:00:00</walltime>
		<nodes>1:ppn=4:tpp=1</nodes>
		<native>--export=NONE</native>

		<join><cyclestr>&ROTDIR;/logs/@Y@m@d@H/gfsmetp#metpcase#.log</cyclestr></join>

		<envar><name>RUN_ENVIR</name><value>emc</value></envar>
		<envar><name>HOMEgfs</name><value>/mnt/lfs1/BMC/gsd-fv3-test/jhender/scratch/emc_gw</value></envar>
		<envar><name>EXPDIR</name><value>/lfs1/BMC/gsd-fv3-test/jhender/scratch/emc_gw/FV3GFSwfm/test</value></envar>
		<envar><name>NET</name><value>gfs</value></envar>
		<envar><name>CDUMP</name><value>gfs</value></envar>
		<envar><name>RUN</name><value>gfs</value></envar>
		<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
		<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
		<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
		<envar><name>COMROOT</name><value>/lfs4/HFIP/hfv3gfs/glopara/com</value></envar>
		<envar><name>DATAROOT</name><value> /lfs1/BMC/gsd-fv3-test/Judy.K.Henderson/scratch/stmp/RUNDIRS/test</value></envar>
		<envar><name>SDATE_GFS</name><value>None</value></envar>
		<envar><name>METPCASE</name><value>#metpcase#</value></envar>

		<dependency>
			<and>
				<metataskdep metatask="gfspost"/>
			</and>
		</dependency>

	</task>

</metatask>

<task name="gfsarch" cycledefs="gfs" maxtries="&MAXTRIES;">

	<command>&JOBS_DIR;/arch.sh</command>

	<jobname><cyclestr>&PSLOT;_gfsarch_@H</cyclestr></jobname>
	<account>hfv3gfs</account>
	<queue>batch</queue>
	<partition>service</partition>
	<walltime>06:00:00</walltime>
	<nodes>1:ppn=1:tpp=1</nodes>
	<memory>4096M</memory>
	<native>--export=NONE</native>

	<join><cyclestr>&ROTDIR;/logs/@Y@m@d@H/gfsarch.log</cyclestr></join>

	<envar><name>RUN_ENVIR</name><value>emc</value></envar>
	<envar><name>HOMEgfs</name><value>/mnt/lfs1/BMC/gsd-fv3-test/jhender/scratch/emc_gw</value></envar>
	<envar><name>EXPDIR</name><value>/lfs1/BMC/gsd-fv3-test/jhender/scratch/emc_gw/FV3GFSwfm/test</value></envar>
	<envar><name>NET</name><value>gfs</value></envar>
	<envar><name>CDUMP</name><value>gfs</value></envar>
	<envar><name>RUN</name><value>gfs</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>COMROOT</name><value>/lfs4/HFIP/hfv3gfs/glopara/com</value></envar>
	<envar><name>DATAROOT</name><value> /lfs1/BMC/gsd-fv3-test/Judy.K.Henderson/scratch/stmp/RUNDIRS/test</value></envar>

	<dependency>
		<and>
			<taskdep task="gfsvrfy"/>
			<metataskdep metatask="gfsmetp"/>
		</and>
	</dependency>

</task>

</workflow>
