<?xml version="1.0"?>
<!DOCTYPE workflow [

  <!ENTITY FV3GFS_HOME "/scratch4/BMC/rtfim/rtruns/FV3-Chem">
  <!ENTITY PSLOT  "rt_fv3gfs_chem">
  <!ENTITY ATCFNAME "FV3GFS_CHEM">          <!-- tracker name -->
  <!ENTITY MODL "FV3GFS_Chem">              <!-- plot name -->
  <!ENTITY ANX_MODEL "GFS">                 <!-- model analysis to use for AC stats -->
  <!ENTITY AC_MODEL_NAME "FV3GFS_CHEM">          <!-- AC stats name -->
  <!ENTITY SOUNDING_MODEL_NAME "FV3GFS_CHEM">
  <!ENTITY SURFACE_MODEL_NAME "FV3GFS_CHEM">
  <!ENTITY RES "0p50">
  <!ENTITY FCST_INTERVAL "6">
  <!ENTITY FCST_LENGTH "168">

  <!-- External parameter entites -->
  <!ENTITY % SITES  SYSTEM "all_sites.xml">  %SITES;
  <!ENTITY % TASKS  SYSTEM "all_tasks.xml">  %TASKS;
  <!ENTITY % DEFS   SYSTEM "all_defs.xml">   %DEFS;

  %theia;
  %metatasks;
]>

<workflow realtime="F" scheduler="&SCHEDULER;" cyclethrottle="12" cyclelifespan="45:00:00">
  <log>
    <cyclestr>&FV3GFS_LOG;/workflow/workflow_@Y@m@d@H_ncl.log</cyclestr>
  </log>

  <cycledef>201902200000 201902200000 24:00:00</cycledef>

  <metatask throttle="25">
<!--     <var name="fcst"> 0 6 12 18 24 30 36 42 48 54 60 66 72 78 84 90 96 102 108 114 120 126 132 138 144 150 156 162 168 </var>
     <var name="T"> 000 006 012 018 024 030 036 042 048 054 060 066 072 078 084 090 096 102 108 114 120 126 132 138 144 150 156 162 168 </var> -->
     <var name="fcst"> 060 </var>
     <var name="T"> 060 </var> 


   <task name="ncl_#T#" maxtries="3">
     <command>&SCRIPTS;/nclfv3_driver.ksh</command>
     <account>&PROJECT;</account>
     <memory>4G</memory>
     <cores>1</cores>
     <native>-W umask=002</native>
     <walltime>00:25:00</walltime>
     <jobname><cyclestr>ncl_#T#</cyclestr></jobname>
     <join><cyclestr>&FV3GFS_LOG;/ncl/ncl#T#_@Y@m@d@H00.log</cyclestr></join>
     <envar><name>FV3GFS_HOME</name><value>&FV3GFS_HOME;</value></envar>
     <envar><name>FV3GFS_RUN</name><value><cyclestr>&FV3GFS_RUN;/&PSLOT;/&CDUMP;.@Y@m@d/@H/</cyclestr></value></envar>
     <envar><name>SCRIPTS</name><value>&SCRIPTS;</value></envar>
     <envar><name>NCL_HOME</name><value>&NCL_HOME;</value></envar>
     <envar><name>MODL</name><value>&MODL;</value></envar>
     <envar><name>ATCFNAME</name><value>&ATCFNAME;</value></envar>
     <envar><name>yyyymmdd</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
     <envar><name>H</name><value><cyclestr>@H</cyclestr></value></envar>
     <envar><name>yyjjjhhmm</name><value><cyclestr>@y@j@H00</cyclestr></value></envar>
     <envar><name>CDUMP</name><value>&CDUMP;</value></envar>
     <envar><name>RES</name><value>&RES;</value></envar>
     <envar><name>T</name><value>#T#</value></envar>
     <envar><name>FCST_TIME</name><value>#fcst#</value></envar>
     <envar><name>FCST_LENGTH</name><value>&FCST_LENGTH;</value></envar>
     <envar><name>GRID_NAMES</name><value>224</value></envar> 
     <dependency>
        <and>
          <datadep age="120"> <cyclestr>&FV3GFS_RUN;/&PSLOT;/&CDUMP;.@Y@m@d/@H/&CDUMP;.t@Hz.pgrb2.&RES;.f#T#</cyclestr></datadep>
          <datadep age="120"> <cyclestr>&FV3GFS_RUN;/&PSLOT;/&CDUMP;.@Y@m@d/@H/&CDUMP;.t@Hz.pgrb2.0p25.f#T#</cyclestr></datadep>
        </and>
     </dependency>
   </task>

  </metatask>

</workflow>
