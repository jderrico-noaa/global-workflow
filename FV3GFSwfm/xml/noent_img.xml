<?xml version="1.0"?>
<!DOCTYPE workflow [
<!ENTITY FV3GFS_HOME "/scratch4/BMC/rtfim/rtruns/FV3-Chem">
<!ENTITY PSLOT "rt_fv3gfs_chem">
<!ENTITY ATCFNAME "FV3GFS_CHEM">
<!-- tracker name --><!ENTITY MODL "FV3GFS_Chem">
<!-- plot name --><!ENTITY ANX_MODEL "GFS">
<!-- model analysis to use for AC stats --><!ENTITY AC_MODEL_NAME "FV3GFS_CHEM">
<!-- AC stats name --><!ENTITY SOUNDING_MODEL_NAME "FV3GFS_CHEM">
<!ENTITY SURFACE_MODEL_NAME "FV3GFS_CHEM">
<!ENTITY RES "0p50">
<!ENTITY FCST_INTERVAL "6">
<!ENTITY FCST_LENGTH "168">
<!-- External parameter entites --><!ENTITY % SITES SYSTEM "all_sites.xml">
<!ENTITY % jet SYSTEM "jet.xml">
<!ENTITY % jet_retro SYSTEM "jet_retro.xml">
<!ENTITY % theia SYSTEM "theia.xml">
<!ENTITY % theia_retro SYSTEM "theia_retro.xml">
<!ENTITY % TASKS SYSTEM "all_tasks.xml">
<!ENTITY archive_ics_task SYSTEM "FV3GFS_ArchiveICS.xml">
<!ENTITY verif_file_task SYSTEM "FV3GFS_GFSVerifFileRealTime.xml">
<!ENTITY verif_task SYSTEM "FV3GFS_VerifRealtime.xml">
<!ENTITY sounding_task SYSTEM "FV3GFS_Soundings.xml">
<!ENTITY ncldiff_task SYSTEM "FV3GFS_NCLdiff.xml">
<!ENTITY nclzip_task SYSTEM "FV3GFS_NCLzip.xml">
<!ENTITY ncldiffzip_task SYSTEM "FV3GFS_NCLdiffzip.xml">
<!ENTITY remapgrib_task SYSTEM "FV3GFS_RemapGrib.xml">
<!ENTITY postncl_task SYSTEM "FV3GFS_PostNCL.xml">
<!ENTITY ncl_task SYSTEM "FV3GFS_NCL.xml">
<!ENTITY nclfim_task SYSTEM "FV3GFS_NCLFim.xml">
<!ENTITY surface_task SYSTEM "FV3GFS_Surface.xml">
<!ENTITY % DEFS SYSTEM "all_defs.xml">
<!ENTITY % dbi SYSTEM "dbi.xml">
<!ENTITY % metatasks SYSTEM "metatask_defs.xml">
<!-- theia --><!ENTITY SCHEDULER "moabtorque">
<!ENTITY PROJECT "gsd-fv3">
<!ENTITY SERIALPE "batch">
<!ENTITY PE "batch">
<!ENTITY SERVICE "service">
<!ENTITY MPIRUN "mpirun -n">
<!ENTITY FV3GFS_LOG "&FV3GFS_HOME;/FV3GFSwfm/log">
<!ENTITY FV3GFS_RUN "&FV3GFS_HOME;/FV3GFSrun">
<!ENTITY FV3GFS_WFM "&FV3GFS_HOME;/FV3GFSwfm">
<!ENTITY SCRIPTS "&FV3GFS_HOME;/FV3GFSwfm/scripts">
<!ENTITY RTFIM_HOME "/home/rtfim">
<!ENTITY SCRATCH4_ROOT "/scratch4/BMC/fim">
<!ENTITY DATADIR "&SCRATCH4_ROOT;/fimdata">
<!ENTITY DATADR2 "&SCRATCH4_ROOT;/GFS_NEMSIO_2017/">
<!ENTITY CLIMATE_DIR "&SCRATCH4_ROOT;/cmean/">
<!ENTITY NCL_HOME "&FV3GFS_HOME;/FV3GFSwfm/ncl/fimall">
<!ENTITY NCL_DIFF_HOME "&FV3GFS_HOME;/FV3GFSwfm/ncl/fimalldiff">
<!ENTITY COPYGB "/home/rtfim/WPPV3.2_intel-12.0.4_opt_mpt-2.05/exec/copygb.exe">
<!-- CHECK THIS  !!! --><!ENTITY CNVGRIB "cnvgrib">
<!ENTITY WGRIB "wgrib">
<!ENTITY WGRIB2 "wgrib2">
<!ENTITY DIFFGB "&RTFIM_HOME;/diffgb/diffgb">
<!ENTITY PUB_DIR "/scratch4/BMC/public">
<!ENTITY GFS_VERIF_DIR "&PUB_DIR;/data/grids/gfs/0p5deg/grib">
<!ENTITY GFS_VERIF_RETRO_DIR "&SCRATCH4_ROOT;/GFS_RETRO_VERIF_FILES">
<!ENTITY FV3GFS_VERIF_DIR "&FV3GFS_RUN;">
<!ENTITY CDUMP "gfs">
<!ENTITY CASE "C384">
<!ENTITY fcst_240hr_metatask '<var name="fcst"> 0 6 12 18 24 30 36 42 48 54 60 66 72 78 84 90 96 102 108 114 120 126 132 138 144 150 156 162 168 174 180 186 192 198 204 210 216 222 228 234 240 </var>'>
<!ENTITY fcst_168hr_metatask '<var name="fcst"> 0 6 12 18 24 30 36 42 48 54 60 66 72 78 84 90 96 102 108 114 120 126 132 138 144 150 156 162 168 </var>'>
<!ENTITY fcst_120hr_metatask '<var name="fcst"> 0 6 12 18 24 30 36 42 48 54 60 66 72 78 84 90 96 102 108 114 120 </var>'>
<!ENTITY t240hr_metatask '<var name="T"> 000 006 012 018 024 030 036 042 048 054 060 066 072 078 084 090 096 102 108 114 120 126 132 138 144 150 156 162 168 174 180 186 192 198 204 210 216 222 228 234 240 </var>'>
<!ENTITY t168hr_metatask '<var name="T"> 000 006 012 018 024 030 036 042 048 054 060 066 072 078 084 090 096 102 108 114 120 126 132 138 144 150 156 162 168 </var>'>
<!ENTITY t120hr_metatask '<var name="T"> 000 006 012 018 024 030 036 042 048 054 060 066 072 078 084 090 096 102 108 114 120 </var>'>
<!ENTITY sounding_240hr_metatask '<var name="fcst">000 012 024 036 048 060 072 084 096 108 120 132 144 156 168 180 192 204 216 228 240 </var>'>
<!ENTITY sounding_168hr_metatask '<var name="fcst">000 012 024 036 048 060 072 084 096 108 120 132 144 156 168 </var>'>
<!ENTITY sounding_120hr_metatask '<var name="fcst">000 012 024 036 048 060 072 084 096 108 120 </var>'>
<!ENTITY surface_72hr_metatask '<var name="fcst">000 024 048 072 </var>'>
]>
<workflow realtime="F" scheduler="moabtorque" cyclethrottle="1">
  <log>
    <cyclestr>/scratch4/BMC/rtfim/rtruns/FV3-Chem/FV3GFSwfm/log/workflow/workflow_@Y@m@d@H_ncl.log</cyclestr>
  </log>

  <cycledef>201806010000 201806180000 24:00:00</cycledef>

  <metatask throttle="25">
    <var name="fcst"> 0 6 12 18 24 30 36 42 48 54 60 66 72 78 84 90 96 102 108 114 120 126 132 138 144 150 156 162 168 </var>
    <var name="T"> 000 006 012 018 024 030 036 042 048 054 060 066 072 078 084 090 096 102 108 114 120 126 132 138 144 150 156 162 168 </var>
      <task name="remapgrib_#T#" maxtries="4">
    <command>/scratch4/BMC/rtfim/rtruns/FV3-Chem/FV3GFSwfm/scripts/remapgrib.ksh</command>
    <account>gsd-fv3</account>
    <cores>1</cores>
    <walltime>00:10:00</walltime>
    <jobname><cyclestr>remapgrib</cyclestr></jobname>
    <join><cyclestr>/scratch4/BMC/rtfim/rtruns/FV3-Chem/FV3GFSwfm/log/remapgrib/remapgrib_@Y@m@d@H_#T#.log</cyclestr></join>
    <envar><name>FV3GFS_RUN</name><value>/scratch4/BMC/rtfim/rtruns/FV3-Chem/FV3GFSrun</value></envar>
    <envar><name>PSLOT</name><value>rt_fv3gfs_chem</value></envar>
    <envar><name>CDUMP</name><value>gfs</value></envar>
    <envar><name>yyjjjhh</name><value><cyclestr>@y@j@H</cyclestr></value></envar>
    <envar><name>yyyymmdd</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>hh</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>fcst</name><value>#T#</value></envar>
    <envar><name>GRID_NAMES</name><value>201D130D244D236D224D242</value></envar>
    <dependency>
      <datadep age="120"><cyclestr>/scratch4/BMC/rtfim/rtruns/FV3-Chem/FV3GFSrun/rt_fv3gfs_chem/gfs.@Y@m@d/@H/gfs.t@Hz.pgrb2.0p25.f#T#</cyclestr></datadep>
    </dependency>
  </task>
 
      <task name="ncl_#T#" maxtries="3">
    <command>/scratch4/BMC/rtfim/rtruns/FV3-Chem/FV3GFSwfm/scripts/nclfv3_driver.ksh</command>
    <account>gsd-fv3</account>
    <memory>4G</memory>
    <cores>1</cores>
    <native>-W umask=002</native>
    <walltime>00:15:00</walltime>
    <jobname><cyclestr>ncl_#T#</cyclestr></jobname>
    <join><cyclestr>/scratch4/BMC/rtfim/rtruns/FV3-Chem/FV3GFSwfm/log/ncl/ncl#T#_@Y@m@d@H00.log</cyclestr></join>
    <envar><name>FV3GFS_HOME</name><value>/scratch4/BMC/rtfim/rtruns/FV3-Chem</value></envar>
    <envar><name>FV3GFS_RUN</name><value><cyclestr>/scratch4/BMC/rtfim/rtruns/FV3-Chem/FV3GFSrun/rt_fv3gfs_chem/gfs.@Y@m@d/@H/</cyclestr></value></envar>
    <envar><name>SCRIPTS</name><value>/scratch4/BMC/rtfim/rtruns/FV3-Chem/FV3GFSwfm/scripts</value></envar>
    <envar><name>NCL_HOME</name><value>/scratch4/BMC/rtfim/rtruns/FV3-Chem/FV3GFSwfm/ncl/fimall</value></envar>
    <envar><name>MODL</name><value>FV3GFS_Chem</value></envar>
    <envar><name>ATCFNAME</name><value>FV3GFS_CHEM</value></envar>
    <envar><name>yyyymmdd</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>H</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>yyjjjhhmm</name><value><cyclestr>@y@j@H00</cyclestr></value></envar>
    <envar><name>CDUMP</name><value>gfs</value></envar>
    <envar><name>RES</name><value>0p50</value></envar>
    <envar><name>T</name><value>#T#</value></envar>
    <envar><name>FCST_TIME</name><value>#fcst#</value></envar>
    <envar><name>FCST_LENGTH</name><value>168</value></envar>
<!--    <envar><name>GRID_NAMES</name><value>fimD201D130D244D236D224D242</value></envar> -->
    <envar><name>GRID_NAMES</name><value>fim</value></envar>
    <dependency>
       <and>
         <datadep age="120"> <cyclestr>/scratch4/BMC/rtfim/rtruns/FV3-Chem/FV3GFSrun/rt_fv3gfs_chem/gfs.@Y@m@d/@H/gfs.t@Hz.pgrb2.0p50.f#T#</cyclestr></datadep>
         <datadep age="120"> <cyclestr>/scratch4/BMC/rtfim/rtruns/FV3-Chem/FV3GFSrun/rt_fv3gfs_chem/gfs.@Y@m@d/@H/gfs.t@Hz.pgrb2.0p25.f#T#</cyclestr></datadep>
       </and>
    </dependency>
  </task>

  </metatask>
    <task name="nclzip" maxtries="3">
    <command>/scratch4/BMC/rtfim/rtruns/FV3-Chem/FV3GFSwfm/scripts/fv3_nclzip.ksh</command>
    <account>gsd-fv3</account>
    <cores>1</cores>
    <walltime>00:55:00</walltime>
    <jobname><cyclestr>nclzip</cyclestr></jobname>
    <join><cyclestr>/scratch4/BMC/rtfim/rtruns/FV3-Chem/FV3GFSwfm/log/ncl/nclzip_@Y@m@d@H.log</cyclestr></join>
    <envar><name>FV3GFS_RUN</name><value>/scratch4/BMC/rtfim/rtruns/FV3-Chem/FV3GFSrun</value></envar>
    <envar><name>yyyymmdd</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>PSLOT</name><value>rt_fv3gfs_chem</value></envar>
    <envar><name>CDUMP</name><value>gfs</value></envar>
    <envar><name>hh</name><value><cyclestr>@H</cyclestr></value></envar>
    <dependency>
      <or>
        <datadep age="120"><cyclestr>/scratch4/BMC/rtfim/rtruns/FV3-Chem/FV3GFSrun/rt_fv3gfs_chem/gfs.@Y@m@d/@H/ncl/fim/pres_pv2_f168.png</cyclestr></datadep>
        <and>
          <timedep><cyclestr offset="020:30:00">@Y@m@d@H@M00</cyclestr></timedep>
          <datadep age="120"><cyclestr>/scratch4/BMC/rtfim/rtruns/FV3-Chem/FV3GFSrun/rt_fv3gfs_chem/gfs.@Y@m@d/@H/ncl/fim/pres_pv2_f000.png</cyclestr></datadep>
        </and>
      </or>
    </dependency>
  </task>
 

</workflow>
